(()=>{"use strict";var e={499:(e,t,n)=>{n.r(t)},557:function(e,t){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function u(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(l){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}};t.__esModule=!0,t.fetchResponse=t.getAIConfiguration=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(Error);t.getAIConfiguration=function(){var e=document.querySelector("#wagtail-ai-config");if(!e||!e.textContent)throw new Error("No wagtail-ai configuration found.");try{return JSON.parse(e.textContent)}catch(e){throw new SyntaxError("Error parsing wagtail-ai configuration: ".concat(e.message))}},t.fetchResponse=function(e,n,r){return o(void 0,void 0,void 0,(function(){var o,u,l,c;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),o=(0,t.getAIConfiguration)().urls,[4,fetch(o[e],{method:"POST",body:n,signal:r})];case 1:return[4,(u=a.sent()).json()];case 2:if(l=a.sent(),u.ok)return[2,l.message];throw new i(l.error);case 3:throw c=a.sent(),new i(c.message);case 4:return[2]}}))}))}},394:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function u(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}l((r=r.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(l){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0;var c=a(n(363)),s=n(3),f=n(533),d=n(166),p=l(n(272)),h=n(851),v=n(557),g=["Processing your query, please wait...","Analyzing your input, just a moment...","Generating a response, hold on...","Thinking, thinking, thinking...","Fetching data, almost there...","Compiling information, please wait...","Crunching numbers, please be patient...","Analyzing data, loading...","Preparing response, please wait...","Interpreting your message, loading..."];function y(e){var t=e.cancelHandler,n=g[Math.floor(Math.random()*g.length)],r=(0,c.useState)(0),o=r[0],a=r[1];return(0,c.useEffect)((function(){var e,t=null===(e=document.querySelector(".Draftail-Editor"))||void 0===e?void 0:e.parentElement;if(t){var n=new ResizeObserver((function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];a(r.contentRect.height)}}));return n.observe(t),function(){n.disconnect()}}}),[]),c.default.createElement("div",{className:"Draftail-AI-LoadingOverlay",style:{height:o?"".concat(o,"px"):"100%"}},c.default.createElement("span",null,c.default.createElement("svg",{className:"icon icon-spinner c-spinner","aria-hidden":"true"},c.default.createElement("use",{href:"#icon-spinner"})),n),c.default.createElement("button",{onClick:t,className:"button button-secondary"},"Cancel request"))}function m(e){var t=e.close,n=e.onAction,r=e.aiPrompts,o=(0,c.useRef)(null);return(0,d.useOutsideAlerter)(o,t),c.default.createElement("div",{ref:o,className:"Draftail-AI-ButtonDropdown"},r.map((function(e){return c.default.createElement("button",{type:"button",onMouseDown:function(){return n(e)}},c.default.createElement("span",null,e.label)," ",e.description)})))}t.default=function(e){var t=this,n=e.getEditorState,r=e.onChange,o=(0,v.getAIConfiguration)().aiPrompts,a=n(),l=(0,c.useState)(!1),d=l[0],g=l[1],b=(0,c.useState)(!1),w=b[0],_=b[1],E=(0,c.useState)(null),x=E[0],S=E[1],A=(0,c.useRef)(),O=(null==A?void 0:A.current)?null==A?void 0:A.current.closest("[data-draftail-editor-wrapper]"):null,M=new AbortController;return c.default.createElement(c.default.Fragment,null,c.default.createElement(s.ToolbarButton,{name:"AI Tools",title:"AI prompts",icon:p.default,onClick:function(){return _(!w)}}),c.default.createElement("span",{ref:A}),w?c.default.createElement(m,{close:function(){return _(!1)},onAction:function(e){return i(t,void 0,void 0,(function(){var t,n,o;return u(this,(function(i){switch(i.label){case 0:S(null),_(!1),g(!0),i.label=1;case 1:return i.trys.push([1,6,,7]),"append"!==e.method?[3,3]:(t=r,[4,(0,h.processAction)(a,e,h.handleAppend,M)]);case 2:return t.apply(void 0,[i.sent()]),[3,5];case 3:return n=r,[4,(0,h.processAction)(a,e,h.handleReplace,M)];case 4:n.apply(void 0,[i.sent()]),i.label=5;case 5:return[3,7];case 6:return o=i.sent(),S(o.message),[3,7];case 7:return g(!1),[2]}}))}))},aiPrompts:o}):null,x&&(null==O?void 0:O.parentNode)?(0,f.createPortal)(c.default.createElement("div",{className:"w-field__errors"},c.default.createElement("svg",{className:"icon icon-warning w-field__errors-icon","aria-hidden":"true"},c.default.createElement("use",{href:"#icon-warning"})),"Â ",c.default.createElement("p",{className:"error-message"},x)),O.parentNode.previousElementSibling):null,d&&O?(0,f.createPortal)(c.default.createElement(y,{cancelHandler:function(e){e.preventDefault(),M.abort(),g(!1)}}),O):null)}},272:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0;var o=r(n(363)),a=n(3),i=o.default.createElement(a.Icon,{icon:o.default.createElement((function(){return o.default.createElement("svg",{width:"16",height:"16",className:"Draftail-Icon","aria-hidden":"true",viewBox:"0 0 576 512"},o.default.createElement("path",{d:"M234.7 42.7L197 56.8c-3 1.1-5 4-5 7.2s2 6.1 5 7.2l37.7 14.1L248.8 123c1.1 3 4 5 7.2 5s6.1-2 7.2-5l14.1-37.7L315 71.2c3-1.1 5-4 5-7.2s-2-6.1-5-7.2L277.3 42.7 263.2 5c-1.1-3-4-5-7.2-5s-6.1 2-7.2 5L234.7 42.7zM46.1 395.4c-18.7 18.7-18.7 49.1 0 67.9l34.6 34.6c18.7 18.7 49.1 18.7 67.9 0L529.9 116.5c18.7-18.7 18.7-49.1 0-67.9L495.3 14.1c-18.7-18.7-49.1-18.7-67.9 0L46.1 395.4zM484.6 82.6l-105 105-23.3-23.3 105-105 23.3 23.3zM7.5 117.2C3 118.9 0 123.2 0 128s3 9.1 7.5 10.8L64 160l21.2 56.5c1.7 4.5 6 7.5 10.8 7.5s9.1-3 10.8-7.5L128 160l56.5-21.2c4.5-1.7 7.5-6 7.5-10.8s-3-9.1-7.5-10.8L128 96 106.8 39.5C105.1 35 100.8 32 96 32s-9.1 3-10.8 7.5L64 96 7.5 117.2zm352 256c-4.5 1.7-7.5 6-7.5 10.8s3 9.1 7.5 10.8L416 416l21.2 56.5c1.7 4.5 6 7.5 10.8 7.5s9.1-3 10.8-7.5L480 416l56.5-21.2c4.5-1.7 7.5-6 7.5-10.8s-3-9.1-7.5-10.8L480 352l-21.2-56.5c-1.7-4.5-6-7.5-10.8-7.5s-9.1 3-10.8 7.5L416 352l-56.5 21.2z"}))}),null)});t.default=i},166:(e,t,n)=>{t.__esModule=!0,t.useOutsideAlerter=void 0;var r=n(363);t.useOutsideAlerter=function(e,t){var n=(0,r.useRef)((function(n){e.current&&!e.current.contains(n.target)&&t()}));(0,r.useEffect)((function(){return document.addEventListener("mousedown",n.current),function(){document.removeEventListener("mousedown",n.current)}}),[n])}},569:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,n(499);var o=r(n(394));window.draftail.registerPlugin({type:"ai",inline:o.default},"controls")},851:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function u(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(l){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}};t.__esModule=!0,t.processAction=t.handleReplace=t.handleAppend=t.fetchAIResponse=void 0;var a=n(603),i=n(557);t.fetchAIResponse=function(e,t,n){return r(void 0,void 0,void 0,(function(){var r;return o(this,(function(o){return(r=new FormData).append("text",e),r.append("prompt",t.uuid),[2,(0,i.fetchResponse)("TEXT_COMPLETION",r,n)]}))}))},t.handleAppend=function(e,t){var n=a.RichUtils.insertSoftNewline(a.EditorState.moveSelectionToEnd(e)),r=n.getCurrentContent(),o=a.Modifier.replaceText(r,a.EditorState.moveSelectionToEnd(n).getSelection(),t);return a.EditorState.push(n,o,"insert-characters")},t.handleReplace=function(e,t){var n=e.getCurrentContent(),r=a.Modifier.replaceText(n,function(e){var t=e.getBlockMap();return new a.SelectionState({anchorKey:t.first().getKey(),anchorOffset:0,focusKey:t.last().getKey(),focusOffset:t.last().getLength()})}(n),t);return a.EditorState.push(e,r,"insert-characters")},t.processAction=function(e,n,a,i){return r(void 0,void 0,void 0,(function(){var r,u,l;return o(this,(function(o){switch(o.label){case 0:return r=e.getCurrentContent(),u=r.getPlainText(),[4,(0,t.fetchAIResponse)(u,n,i.signal)];case 1:return l=o.sent(),[2,a(e,l)]}}))}))}},603:e=>{e.exports=DraftJS},3:e=>{e.exports=Draftail},363:e=>{e.exports=React},533:e=>{e.exports=ReactDOM}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(569)})();